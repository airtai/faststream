<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.7.1 plugin-docs plugin-id-default docs-doc-id-guides/Guide_24_Using_Multiple_Kafka_Clusters">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Using multiple Kafka clusters | FastKafka</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" name="twitter:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" property="og:url" content="https://fastkafka.airt.ai/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.7.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.7.1"><meta data-rh="true" name="docsearch:version" content="0.7.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.7.1"><meta data-rh="true" property="og:title" content="Using multiple Kafka clusters | FastKafka"><meta data-rh="true" name="description" content="Ready to take your FastKafka app to the next level? This guide shows you"><meta data-rh="true" property="og:description" content="Ready to take your FastKafka app to the next level? This guide shows you"><link data-rh="true" rel="icon" href="/img/AIRT_icon_blue.svg"><link data-rh="true" rel="canonical" href="https://fastkafka.airt.ai/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EHYNSIUGMY-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WLMWPELHMB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WLMWPELHMB",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="FastKafka" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.afdeec1f.css">
<link rel="preload" href="/assets/js/runtime~main.71494bfb.js" as="script">
<link rel="preload" href="/assets/js/main.7ba204b8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://airt.ai" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">airt</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link fastkafka-home navbar__link--active" href="/"><div><img src="/img/home-icon.svg"><p>FastKafka</p></div></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.7.1/">0.7.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/guides/Guide_24_Using_Multiple_Kafka_Clusters/">dev ðŸš§</a></li><li><a class="dropdown__link" href="/docs/guides/Guide_24_Using_Multiple_Kafka_Clusters/">0.8.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/">0.7.1</a></li><li><a class="dropdown__link" href="/docs/0.7.0/guides/Guide_24_Using_Multiple_Kafka_Clusters/">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.0/">0.5.0</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/0.7.1/">Docs</a><div class="navbar__item github-stars"><iframe src="https://ghbtns.com/github-btn.html?user=airtai&repo=fastkafka&type=star&count=true&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe></div><a href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord Link"></a><a aria-current="page" class="navbar__item navbar__link fastkafka-home-mobile navbar__link--active" href="/"><div><img src="/img/home-icon.svg"></div></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.1/">FastKafka</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/0.7.1/guides/Guide_11_Consumes_Basics/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/0.7.1/guides/Guide_11_Consumes_Basics/">Writing services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_11_Consumes_Basics/">@consumes basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_12_Batch_Consuming/">Batch consuming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_21_Produces_Basics/">@produces basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_22_Partition_Keys/">Defining a partition key</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_23_Batch_Producing/">Batch producing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_05_Lifespan_Handler/">Lifespan Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.7.1/guides/Guide_07_Encoding_and_Decoding_Messages_with_FastKafka/">Encoding and Decoding Kafka Messages with FastKafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/0.7.1/guides/Guide_24_Using_Multiple_Kafka_Clusters/">Using multiple Kafka clusters</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.1/guides/Guide_31_Using_redpanda_to_test_fastkafka/">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.1/guides/Guide_04_Github_Actions_Workflow/">Documentation generation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.1/guides/Guide_30_Using_docker_to_deploy_fastkafka/">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.1/guides/Guide_06_Benchmarking_FastKafka/">Benchmarking</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/0.7.1/api/fastkafka/EventMetadata/">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/0.7.1/cli/fastkafka/">CLI</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.1/LICENSE/">LICENSE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.1/CONTRIBUTING/">Contributing to fastkafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.1/CHANGELOG/">Release notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->FastKafka<!-- --> <b>0.7.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/guides/Guide_24_Using_Multiple_Kafka_Clusters/">latest version</a></b> (<!-- -->0.8.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Writing services</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Using multiple Kafka clusters</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.7.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Using multiple Kafka clusters</h1><p>Ready to take your FastKafka app to the next level? This guide shows you
how to connect to multiple Kafka clusters effortlessly. Consolidate
topics and produce messages across clusters like a pro. Unleash the full
potential of your Kafka-powered app with FastKafka. Letâ€™s dive in and
elevate your applicationâ€™s capabilities!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-message">Test message<a href="#test-message" class="hash-link" aria-label="Direct link to Test message" title="Direct link to Test message">â€‹</a></h3><p>To showcase the functionalities of FastKafka and illustrate the concepts
discussed, we can use a simple test message called <code>TestMsg</code>. Hereâ€™s the
definition of the <code>TestMsg</code> class:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-multiple-broker-configurations">Defining multiple broker configurations<a href="#defining-multiple-broker-configurations" class="hash-link" aria-label="Direct link to Defining multiple broker configurations" title="Direct link to Defining multiple broker configurations">â€‹</a></h2><p>When building a FastKafka application, you may need to consume messages
from multiple Kafka clusters, each with its own set of broker
configurations. FastKafka provides the flexibility to define different
broker clusters using the brokers argument in the consumes decorator.
Letâ€™s explore an example code snippet</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_1 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    development</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;dev.server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    production</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;prod.server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_2 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    development</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;dev.server_2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    production</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;prod.server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Received on s1: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">msg</span><span class="token string-interpolation interpolation operator" style="color:#D73A49">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Received on s2: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">msg</span><span class="token string-interpolation interpolation operator" style="color:#D73A49">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> msg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the application has two consumes endpoints, both of
which will consume events from <code>preprocessed_signals</code> topic.
<code>on_preprocessed_signals_1</code> will consume events from <code>kafka_brokers_1</code>
configuration and <code>on_preprocessed_signals_2</code> will consume events from
<code>kafka_brokers_2</code> configuration. When producing, <code>to_predictions_1</code> will
produce to <code>predictions</code> topic on <code>kafka_brokers_1</code> cluster and
<code>to_predictions_2</code> will produce to <code>predictions</code> topic on
<code>kafka_brokers_2</code> cluster.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">â€‹</a></h4><p>The <code>kafka_brokers_1</code> configuration represents the primary cluster,
while <code>kafka_brokers_2</code> serves as an alternative cluster specified in
the decorator.</p><p>Using the FastKafka class, the app object is initialized with the
primary broker configuration (<code>kafka_brokers_1</code>). By default, the
<code>@app.consumes</code> decorator without the brokers argument consumes messages
from the <code>preprocessed_signals</code> topic on <code>kafka_brokers_1</code>.</p><p>To consume messages from a different cluster, the <code>@app.consumes</code>
decorator includes the <code>brokers</code> argument. This allows explicit
specification of the broker cluster in the <code>on_preprocessed_signals_2</code>
function, enabling consumption from the same topic but using the
<code>kafka_brokers_2</code> configuration.</p><p>The brokers argument can also be used in the @app.produces decorator to
define multiple broker clusters for message production.</p><p>Itâ€™s important to ensure that all broker configurations have the same
required settings as the primary cluster to ensure consistent behavior.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-application">Testing the application<a href="#testing-the-application" class="hash-link" aria-label="Direct link to Testing the application" title="Direct link to Testing the application">â€‹</a></h2><p>To test our FastKafka â€˜mirroringâ€™ application, we can use our testing
framework. Lets take a look how itâ€™s done:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Send TestMsg to topic/broker pair on_preprocessed_signals_1 is consuming from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert on_preprocessed_signals_1 consumed sent message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">awaited_mocks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert app has produced a prediction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_predictions_1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Send TestMsg to topic/broker pair on_preprocessed_signals_2 is consuming from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert on_preprocessed_signals_2 consumed sent message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">awaited_mocks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert app has produced a prediction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_predictions_2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal_s2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.720 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._start() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.720 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._patch_consumers_and_producers(): Patching consumers and producers!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.721 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.721 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;dev.server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.722 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.722 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;dev.server_2:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.723 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.741 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;dev.server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.741 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.742 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;dev.server_2:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.743 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.744 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.746 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;dev.server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.746 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.747 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.748 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.748 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.749 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.754 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.754 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;dev.server_2:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.755 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.755 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.755 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.756 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.756 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.757 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.757 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;dev.server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.758 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.758 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.759 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.759 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.759 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.760 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.761 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;dev.server_2:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.762 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.762 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.762 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.763 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:08.763 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Received on s1: msg=TestMsg(msg=&#x27;signal_s1&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Received on s2: msg=TestMsg(msg=&#x27;signal_s2&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.745 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.746 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.746 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.747 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.747 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.748 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.748 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.749 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.749 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.750 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.750 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.751 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.751 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.751 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.753 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.753 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.753 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:13.754 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The usage of the <code>tester.mirrors</code> dictionary allows specifying the
desired topic/broker combination for sending the test messages,
especially when working with multiple Kafka clusters. This ensures that
the data is sent to the appropriate topic/broker based on the consuming
function, and consumed from appropriate topic/broker based on the
producing function.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-application">Running the application<a href="#running-the-application" class="hash-link" aria-label="Direct link to Running the application" title="Direct link to Running the application">â€‹</a></h2><p>You can run your application using <code>fastkafka run</code> CLI command in the
same way that you would run a single cluster app.</p><p>To start your app, copy the code above in multi_cluster_example.py and
run it by running:</p><p>Now we can run the app. Copy the code above in multi_cluster_example.py,
adjust your server configurations, and run it by running</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka run --num-workers</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> --kafka-broker</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">development multi_cluster_example:app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In your app logs, you should see your app starting up and your two
consumer functions connecting to different kafka clusters.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.699 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.700 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;127.0.0.1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.700 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.700 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;127.0.0.1:57647&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.714 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.714 [INFO] aiokafka.consumer.subscription_state: Updating subscribed topics to: frozenset({&#x27;preprocessed_signals&#x27;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.714 [INFO] aiokafka.consumer.consumer: Subscribed to topic(s): {&#x27;preprocessed_signals&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.714 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.718 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.718 [INFO] aiokafka.consumer.subscription_state: Updating subscribed topics to: frozenset({&#x27;preprocessed_signals&#x27;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.718 [INFO] aiokafka.consumer.consumer: Subscribed to topic(s): {&#x27;preprocessed_signals&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.718 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.722 [INFO] aiokafka.consumer.group_coordinator: Metadata for topic has changed from {} to {&#x27;preprocessed_signals&#x27;: 1}. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:29.723 [INFO] aiokafka.consumer.group_coordinator: Metadata for topic has changed from {} to {&#x27;preprocessed_signals&#x27;: 1}. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting process cleanup, this may take a few seconds...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:33.548 [INFO] fastkafka._server: terminate_asyncio_process(): Terminating the process 90735...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:34.666 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:34.667 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:34.667 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[90735]: 23-05-30 10:33:34.667 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:34.777 [INFO] fastkafka._server: terminate_asyncio_process(): Process 90735 terminated.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-documentation">Application documentation<a href="#application-documentation" class="hash-link" aria-label="Direct link to Application documentation" title="Direct link to Application documentation">â€‹</a></h2><p>At the moment the documentation for multicluster app is not yet
implemented, but it is under development and you can expecti it soon!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples-on-how-to-use-multiple-broker-configurations">Examples on how to use multiple broker configurations<a href="#examples-on-how-to-use-multiple-broker-configurations" class="hash-link" aria-label="Direct link to Examples on how to use multiple broker configurations" title="Direct link to Examples on how to use multiple broker configurations">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example <!-- -->#<!-- -->1<a href="#example-1" class="hash-link" aria-label="Direct link to example-1" title="Direct link to example-1">â€‹</a></h3><p>In this section, weâ€™ll explore how you can effectively forward topics
between different Kafka clusters, enabling seamless data synchronization
for your applications.</p><p>Imagine having two Kafka clusters, namely <code>kafka_brokers_1</code> and
<code>kafka_brokers_2</code>, each hosting its own set of topics and messages. Now,
if you want to forward a specific topic (in this case:
<code>preprocessed_signals</code>) from kafka_brokers_1 to kafka_brokers_2,
FastKafka provides an elegant solution.</p><p>Letâ€™s examine the code snippet that configures our application for topic
forwarding:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_1 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_2 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals_original</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_preprocessed_signals_forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_preprocessed_signals_forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hereâ€™s how it works: our FastKafka application is configured to consume
messages from <code>kafka_brokers_1</code> and process them in the
<code>on_preprocessed_signals_original</code> function. We want to forward these
messages to <code>kafka_brokers_2</code>. To achieve this, we define the
<code>to_preprocessed_signals_forward</code> function as a producer, seamlessly
producing the processed messages to the preprocessed_signals topic
within the <code>kafka_brokers_2</code> cluster.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">â€‹</a></h4><p>To test our FastKafka forwarding application, we can use our testing
framework. Letâ€™s take a look at the testing code snippet:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_original</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_preprocessed_signals_forward</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.969 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._start() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.970 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._patch_consumers_and_producers(): Patching consumers and producers!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.971 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.972 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.972 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.982 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.982 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.983 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.984 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.984 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.985 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.985 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.986 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.987 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.988 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.988 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.989 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.989 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.990 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.990 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:40.991 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.983 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.984 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.984 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.985 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.985 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.986 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.987 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.987 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.987 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:44.988 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the help of the <strong>Tester</strong> object, we can simulate and verify the
behavior of our FastKafka application. Hereâ€™s how it works:</p><ol><li><p>We create an instance of the <strong>Tester</strong> by passing in our <em>app</em>
object, which represents our FastKafka application.</p></li><li><p>Using the <strong>tester.mirrors</strong> dictionary, we can send a message to a
specific Kafka broker and topic combination. In this case, we use
<code>tester.mirrors[app.on_preprocessed_signals_original]</code> to send a
TestMsg message with the content â€œsignal&quot; to the appropriate Kafka
broker and topic.</p></li><li><p>After sending the message, we can perform assertions on the mirrored
function using
<code>tester.mirrors[app.to_preprocessed_signals_forward].assert_called(timeout=5)</code>.
This assertion ensures that the mirrored function has been called
within a specified timeout period (in this case, 5 seconds).</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-2">Example <!-- -->#<!-- -->2<a href="#example-2" class="hash-link" aria-label="Direct link to example-2" title="Direct link to example-2">â€‹</a></h3><p>In this section, weâ€™ll explore how you can effortlessly consume data
from multiple sources, process it, and aggregate the results into a
single topic on a specific cluster.</p><p>Imagine you have two Kafka clusters: <strong>kafka_brokers_1</strong> and
<strong>kafka_brokers_2</strong>, each hosting its own set of topics and messages.
Now, what if you want to consume data from both clusters, perform some
processing, and produce the results to a single topic on
<strong>kafka_brokers_1</strong>? FastKafka has got you covered!</p><p>Letâ€™s take a look at the code snippet that configures our application
for aggregating multiple clusters:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_1 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_2 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Default: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">msg</span><span class="token string-interpolation interpolation operator" style="color:#D73A49">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Specified: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">msg</span><span class="token string-interpolation interpolation operator" style="color:#D73A49">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Sending prediction: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">prediction</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hereâ€™s the idea: our FastKafka application is set to consume messages
from the topic â€œpreprocessed_signals&quot; on <strong>kafka_brokers_1</strong> cluster, as
well as from the same topic on <strong>kafka_brokers_2</strong> cluster. We have two
consuming functions, <code>on_preprocessed_signals_1</code> and
<code>on_preprocessed_signals_2</code>, that handle the messages from their
respective clusters. These functions perform any required processing, in
this case, just calling the to_predictions function.</p><p>The exciting part is that the to_predictions function acts as a
producer, sending the processed results to the â€œpredictions&quot; topic on
<strong>kafka_brokers_1 cluster</strong>. By doing so, we effectively aggregate the
data from multiple sources into a single topic on a specific cluster.</p><p>This approach enables you to consume data from multiple Kafka clusters,
process it, and produce the aggregated results to a designated topic.
Whether youâ€™re generating predictions, performing aggregations, or any
other form of data processing, FastKafka empowers you to harness the
full potential of multiple clusters.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-1">Testing<a href="#testing-1" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">â€‹</a></h4><p>Letâ€™s take a look at the testing code snippet:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_preprocessed_signals_2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_predictions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.827 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._start() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.827 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._patch_consumers_and_producers(): Patching consumers and producers!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.828 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.829 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.829 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.875 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.875 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.876 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.876 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.877 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.878 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.879 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.879 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.879 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.880 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.880 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.881 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.881 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.881 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.882 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.882 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.883 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.883 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.883 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.884 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.885 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.885 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.886 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.886 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:50.886 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default: msg=TestMsg(msg=&#x27;signal&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending prediction: msg=&#x27;signal&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Specified: msg=TestMsg(msg=&#x27;signal&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending prediction: msg=&#x27;signal&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.877 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.878 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.878 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.879 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.880 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.881 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.881 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.881 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.882 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.882 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.883 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.884 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.884 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:33:54.884 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hereâ€™s how the code above works:</p><ol><li><p>Within an <code>async with</code> block, create an instance of the Tester by
passing in your app object, representing your FastKafka application.</p></li><li><p>Using the tester.mirrors dictionary, you can send messages to
specific Kafka broker and topic combinations. In this case, we use
<code>tester.mirrors[app.on_preprocessed_signals_1]</code> and
<code>tester.mirrors[app.on_preprocessed_signals_2]</code> to send TestMsg
messages with the content â€œsignal&quot; to the corresponding Kafka broker
and topic combinations.</p></li><li><p>After sending the messages, you can perform assertions on the
<strong>on_predictions</strong> function using
<code>tester.on_predictions.assert_called(timeout=5)</code>. This assertion
ensures that the on_predictions function has been called within a
specified timeout period (in this case, 5 seconds).</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-3">Example <!-- -->#<!-- -->3<a href="#example-3" class="hash-link" aria-label="Direct link to example-3" title="Direct link to example-3">â€‹</a></h3><p>In some scenarios, you may need to produce messages to multiple Kafka
clusters simultaneously. FastKafka simplifies this process by allowing
you to configure your application to produce messages to multiple
clusters effortlessly. Letâ€™s explore how you can achieve this:</p><p>Consider the following code snippet that demonstrates producing messages
to multiple clusters:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_1 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers_2 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localhost</span><span class="token operator" style="color:#D73A49">=</span><span class="token builtin" style="color:#005CC5">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;server_2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;preprocessed_signals&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_preprocessed_signals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">msg</span><span class="token string-interpolation interpolation operator" style="color:#D73A49">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;prediction&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;prediction&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions_1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Sending prediction to s1: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">prediction</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions_2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> TestMsg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#C6105F">f&quot;Sending prediction to s2: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">prediction</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#C6105F">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prediction</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hereâ€™s what you need to know about producing to multiple clusters:</p><ol><li><p>We define two Kafka broker configurations: <strong>kafka_brokers_1</strong> and
<strong>kafka_brokers_2</strong>, representing different clusters with their
respective connection details.</p></li><li><p>We create an instance of the FastKafka application, specifying
<strong>kafka_brokers_1</strong> as the primary cluster for producing messages.</p></li><li><p>The <code>on_preprocessed_signals</code> function serves as a consumer,
handling incoming messages from the â€œpreprocessed_signals&quot; topic.
Within this function, we invoke two producer functions:
<code>to_predictions_1</code> and <code>to_predictions_2</code>.</p></li><li><p>The <code>to_predictions_1</code> function sends predictions to the
â€œpredictions&quot; topic on <em>kafka_brokers_1</em> cluster.</p></li><li><p>Additionally, the <code>to_predictions_2</code> function sends the same
predictions to the â€œpredictions&quot; topic on <em>kafka_brokers_2</em> cluster.
This allows for producing the same data to multiple clusters
simultaneously.</p></li></ol><p>By utilizing this approach, you can seamlessly produce messages to
multiple Kafka clusters, enabling you to distribute data across
different environments or leverage the strengths of various clusters.</p><p>Feel free to customize the producer functions as per your requirements,
performing any necessary data transformations or enrichment before
sending the predictions.</p><p>With FastKafka, producing to multiple clusters becomes a breeze,
empowering you to harness the capabilities of multiple environments
effortlessly.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-2">Testing<a href="#testing-2" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">â€‹</a></h4><p>Letâ€™s take a look at the testing code snippet:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_preprocessed_signals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TestMsg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;signal&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">to_predictions_1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">to_predictions_2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_called</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.033 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._start() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.034 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._patch_consumers_and_producers(): Patching consumers and producers!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.035 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.036 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.037 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.038 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.038 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.052 [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.053 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.054 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.055 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.055 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.056 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.056 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.057 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;preprocessed_signals&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.057 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.057 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.058 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_1:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.058 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.059 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.059 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.062 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.062 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.063 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.063 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100, &#x27;bootstrap_servers&#x27;: &#x27;server_2:9092&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.064 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.064 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.065 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.065 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:00.065 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msg=TestMsg(msg=&#x27;signal&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending prediction to s1: msg=&#x27;prediction&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending prediction to s2: msg=&#x27;prediction&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.055 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.055 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.056 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.056 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.057 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.057 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.058 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.058 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.058 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.059 [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.059 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.060 [INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.060 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23-05-30 10:34:04.060 [INFO] fastkafka._testing.in_memory_broker: InMemoryBroker stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hereâ€™s how you can perform the necessary tests:</p><ol><li><p>Within an async with block, create an instance of the <strong>Tester</strong> by
passing in your app object, representing your FastKafka application.</p></li><li><p>Using the <code>tester.to_preprocessed_signals</code> method, you can send a
TestMsg message with the content â€œsignal&quot;.</p></li><li><p>After sending the message, you can perform assertions on the
to_predictions_1 and to_predictions_2 functions using
<code>tester.mirrors[to_predictions_1].assert_called(timeout=5)</code> and
<code>tester.mirrors[to_predictions_2].assert_called(timeout=5)</code>. These
assertions ensure that the respective producer functions have
produced data to their respective topic/broker combinations.</p></li></ol><p>By employing this testing approach, you can verify that the producing
functions correctly send messages to their respective clusters. The
testing framework provided by FastKafka enables you to ensure the
accuracy and reliability of your applicationâ€™s producing logic.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/0.7.1/guides/Guide_07_Encoding_and_Decoding_Messages_with_FastKafka/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Encoding and Decoding Kafka Messages with FastKafka</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/0.7.1/guides/Guide_31_Using_redpanda_to_test_fastkafka/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Redpanda to test FastKafka</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#test-message" class="table-of-contents__link toc-highlight">Test message</a></li><li><a href="#defining-multiple-broker-configurations" class="table-of-contents__link toc-highlight">Defining multiple broker configurations</a></li><li><a href="#testing-the-application" class="table-of-contents__link toc-highlight">Testing the application</a></li><li><a href="#running-the-application" class="table-of-contents__link toc-highlight">Running the application</a></li><li><a href="#application-documentation" class="table-of-contents__link toc-highlight">Application documentation</a></li><li><a href="#examples-on-how-to-use-multiple-broker-configurations" class="table-of-contents__link toc-highlight">Examples on how to use multiple broker configurations</a><ul><li><a href="#example-1" class="table-of-contents__link toc-highlight">Example #1</a></li><li><a href="#example-2" class="table-of-contents__link toc-highlight">Example #2</a></li><li><a href="#example-3" class="table-of-contents__link toc-highlight">Example #3</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">COMMUNITY</div><ul class="footer__items clean-list"><li class="footer__item">
                      <a class="footer-discord-link" href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noreferrer noopener" aria-label="Discord link"></a>
                    </li><li class="footer__item">
                      <a class="footer-github-link" href="https://github.com/airtai" target="_blank" rel="noreferrer noopener" aria-label="Github link"></a>
                    </li><li class="footer__item">
                      <a class="footer-twitter-link" href="https://twitter.com/airt_AI" target="_blank" rel="noreferrer noopener" aria-label="Twitter link"></a>
                    </li><li class="footer__item">
                      <a class="footer-facebook-link" href="https://www.facebook.com/airt.ai.api/" target="_blank" rel="noreferrer noopener" aria-label="Facebook link"></a>
                    </li><li class="footer__item">
                      <a class="footer-linkedin-link" href="https://www.linkedin.com/company/airt-ai/" target="_blank" rel="noreferrer noopener" aria-label="LinkedIn link"></a>
                    </li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE DOCS</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE MORE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://airt.ai/news" target="_blank" rel="noopener noreferrer" class="footer__link-item">News</a></li><li class="footer__item"><a href="https://airt.ai/about-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li><li class="footer__item"><a href="https://airt.ai/company-information" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company information</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2023 airt. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.71494bfb.js"></script>
<script src="/assets/js/main.7ba204b8.js"></script>
</body>
</html>